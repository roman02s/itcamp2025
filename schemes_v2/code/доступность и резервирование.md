@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
LAYOUT_WITH_LEGEND()
title НПЗ — Доступность и резервирование

System_Boundary(apps, "Прикладной контур") {
  Container(erp, "1С ERP / CMMS", "App Cluster", "N+1 / горизонтальная отказоустойчивость")
  Container(apigw, "API Gateway / WAF", "Reverse proxy", "L7 защита, health-check")
}

System_Boundary(db, "Данные/БД") {
  ContainerDb(db1, "БД приложений (Primary)", "RDBMS", "Sync commit / quorum")
  ContainerDb(db2, "БД приложений (Standby)", "RDBMS", "Hot standby")
  Container(backup, "Backup/VTL", "Snapshots/Archives", "GFS, офлайн-копии")
}

Container(kafka, "Kafka Cluster", "3 брокера", "N+1, ISR ≥2")

Rel(erp, db1, "RW транзакции")
Rel_R(db1, db2, "Синхронная репликация")
Rel(erp, apigw, "Публикация API/health")
Rel(erp, kafka, "События/аудит")
Rel(db1, backup, "Снапшоты/журналы", "по расписанию")
Rel(kafka, backup, "Архивы логов", "по расписанию")
@enduml
